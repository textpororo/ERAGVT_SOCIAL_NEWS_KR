;양 구멍 피니쉬（ＶＡ계통으로부터의 파생 한정 행동）

;성 커맨드 분류
@SEX_TYPE_COM20
RETURN 삽입

@SEX_COM20,ARG = 0,ARG:1 = 0
;EX_COM	추가 고문 실행 부위（비트）
;	1：Ｃ　2：Ｖ　4：Ａ　8：Ｂ
;추가 고문
CALL SEX_COMEX_RANDOM, Ｖ+Ａ, ARG:1
EX_COM = RESULT:0
SH_COM = RESULT:1

;사정 부위 플래그:질과 애널을 세운다
TFLAG:4 = TFLAG:4 | 질
TFLAG:4 = TFLAG:4 | 애널
INSERT = INSERT | 질
INSERT = INSERT | 애널
;촉수를 쓰고 있다면 손과 입을 세운다
IF (FLAG:110 == 1) && ISTENTACLER(FLAG:111) == 0 && (TALENT:(FLAG:111):후타나리 > 0 || ISMALE(FLAG:111))
ELSE
	TFLAG:4 = TFLAG:4 | 손
	TFLAG:4 = TFLAG:4 | 입
ENDIF
;Ｂ추가 공격이 있다면 가슴을 세운다
SIF (EX_COM & Ｂ)
	TFLAG:4 = TFLAG:4 | 가슴

;흑화 캐릭터의 페니스 위치를 세트
IF ENEMY_TYPE_CHECK_F("AKUOTI") == 1 && (ISPENIS(FLAG:111))
	IF RAND:2 == 0
		TFLAG:18 = 질
	ELSE
		TFLAG:18 = 애널
	ENDIF
ENDIF

;취득 파라미터 계산
;BASE값의 명시적 초기화
REPEAT 12
	LOCAL:COUNT = 0
REND

;방심도 상승
TFLAG:3 += 300

;사정치 1200
CALL TENTACLE_SYASEI_UP, 1200

;촉수 크기 설정
CALL SET_TENTACLE_SIZE, FLAG:10, FLAG:11, ENEMY_TYPE_CHECK_F("AKUOTI"), FLAG:111, 20


;쾌Ｖ
IF ABL:Ｖ감각 == 0
	LOCAL:1 = 3450
ELSEIF ABL:Ｖ감각 == 1
	LOCAL:1 = 4125
ELSEIF ABL:Ｖ감각 == 2
	LOCAL:1 = 6000
ELSEIF ABL:Ｖ감각 == 3
	LOCAL:1 = 8250
ELSEIF ABL:Ｖ감각 == 4
	LOCAL:1 = 10500
ELSEIF ABL:Ｖ감각 >= 5
	LOCAL:1 = 15000
ENDIF

;쾌Ａ
IF CONFIG_CHECK_BALANCE_F(7) == 0
	IF ABL:Ａ감각 == 0
		LOCAL:2 = 690
	ELSEIF ABL:Ａ감각 == 1
		LOCAL:2 = 2065
	ELSEIF ABL:Ａ감각 == 2
		LOCAL:2 = 6000
	ELSEIF ABL:Ａ감각 == 3
		LOCAL:2 = 8250
	ELSEIF ABL:Ａ감각 == 4
		LOCAL:2 = 10500
	ELSEIF ABL:Ａ감각 >= 5
		LOCAL:2 = 15000
	ENDIF
;컨피그 ON이라면 쾌Ａ 증가
ELSEIF CONFIG_CHECK_BALANCE_F(7) > 0
	IF ABL:Ａ감각 == 0
		LOCAL:2 = 3450
	ELSEIF ABL:Ａ감각 == 1
		LOCAL:2 = 4125
	ELSEIF ABL:Ａ감각 == 2
		LOCAL:2 = 6000
	ELSEIF ABL:Ａ감각 == 3
		LOCAL:2 = 8250
	ELSEIF ABL:Ａ감각 == 4
		LOCAL:2 = 10500
	ELSEIF ABL:Ａ감각 >= 5
		LOCAL:2 = 15000
	ENDIF
ENDIF
;메인 부위 절정 예정의 예측
CALL PALAM_VABCestimate(LOCAL,1,2,-1)



IF ENEMY_TYPE_CHECK_F("MOB") == 1
	TRYCALLFORM MESSAGE_MOB_{ARG}_COM20, EX_COM, SH_COM
ELSE
	;지문: 세뇌/흑화 캐릭터가 조작 캐릭터에게 양 구멍 피니쉬를 했다
	SIF ENEMY_TYPE_CHECK_F("AKUOTI") == 1
		CALL MESSAGE_OTHER_SEX_COM20
	;지문: COM20
	CALL MESSAGE_SEX_COM20, EX_COM, SH_COM
ENDIF

;결계에 따른 촉수 개수의 변동
CALL SET_TENTACLE_POOL
;의상에의 피해
CALL CLOTH_BATTLE_DAMAGE, 3

;BASE
EXP:Ｖ경험 += 1
EXP:Ａ경험 += 1
SIF ENEMY_TYPE_CHECK_F("AKUOTI") == 0 && INCEST_F(TARGET, FLAG:10 * 100 + FLAG:11, 1) > 0
	EXP:근친교배경험 += 1
SIF ENEMY_TYPE_CHECK_F("AKUOTI") == 1 && INCEST_F(TARGET, FLAG:111) > 0
	EXP:근친교배경험 += 1


;공순
IF ABL:순종 <= 2
	LOCAL:5 = 400
ELSEIF ABL:순종 == 3
	LOCAL:5 = 1000
ELSEIF ABL:순종 == 4
	LOCAL:5 = 2000
ELSEIF ABL:순종 >= 5
	LOCAL:5 = 4000
ENDIF

;습득
IF ABL:봉사정신 == 0
	LOCAL:6 = 15
ELSEIF ABL:봉사정신 == 1
	LOCAL:6 = 35
ELSEIF ABL:봉사정신 == 2
	LOCAL:6 = 80
ELSEIF ABL:봉사정신 == 3
	LOCAL:6 = 135
ELSEIF ABL:봉사정신 == 4
	LOCAL:6 = 300
ELSEIF ABL:봉사정신 >= 5
	LOCAL:6 = 600
ENDIF

;굴복　Ａ감각에 의존
IF ABL:Ａ감각 == 0
	LOCAL:8 = 15
ELSEIF ABL:Ａ감각 == 1
	LOCAL:8 = 30
ELSEIF ABL:Ａ감각 == 2
	LOCAL:8 = 75
ELSEIF ABL:Ａ감각 == 3
	LOCAL:8 = 150
ELSEIF ABL:Ａ감각 == 4
	LOCAL:8 = 300
ELSEIF ABL:Ａ감각 >= 5
	LOCAL:8 = 650 + ABL:Ａ감각 * 15
ENDIF

;윤활이 낮으면 고통이 들어간다
IF PALAM:윤활 < 1000
	LOCAL:10 += 1500
ELSEIF PALAM:윤활 < 2000
	LOCAL:10 += 300
ENDIF

;Ｖ감각이 낮으면 공포가 들어간다
IF ABL:Ｖ감각 == 0
	LOCAL:11 = 300
ELSEIF ABL:Ｖ감각 == 1
	LOCAL:11 = 75
ELSEIF ABL:Ｖ감각 == 2
	LOCAL:11 = 30
ELSEIF ABL:Ｖ감각 == 3
	LOCAL:11 = 15
ELSE
ENDIF
;Ａ감각이 낮으면 공포가 들어간다
IF ABL:Ａ감각 == 0
	LOCAL:11 = 150
ELSEIF ABL:Ａ감각 == 1
	LOCAL:11 = 75
ELSEIF ABL:Ａ감각 == 2
	LOCAL:11 = 35
ELSEIF ABL:Ａ감각 == 3
	LOCAL:11 = 15
ELSE
ENDIF

;추가 고문 실행
IF EX_COM
	CALL SEX_COMEX, Ｖ+Ａ, 1, EX_COM | SH_COM
	REPEAT 12
		LOCAL:COUNT += RESULT:COUNT
	REND
ENDIF

;행동 예약 없음
TFLAG:17 = -1
;촉수의 행동을 기록
TFLAG:20 = 20

;강구속 상태를 해제
SIF (TCVARn:12 & 강구속)
	TCVARn:12 -= 강구속

;습득 기본값
LOCAL:6 += 100

;욕정 기본값
LOCAL:7 += 2000

;굴복 기본값
LOCAL:8 += 8000

;치정 기본값
LOCAL:9 += 2000

;고통 기본값
LOCAL:10 += 0

;공포 기본값
LOCAL:11 += 3000

;체력 소비 기본값
LOCAL:12 += 1000

;계산으로
CALL PALAM_CAL, LOCAL:0, LOCAL:1, LOCAL:2, LOCAL:3, LOCAL:4, LOCAL:5, LOCAL:6, LOCAL:7, LOCAL:8, LOCAL:9, LOCAL:10, LOCAL:11, LOCAL:12
